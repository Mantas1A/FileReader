<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Reader</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .error { color: red; margin: 10px 0; }
        .data-container { margin: 20px 0; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Upload and View File</h1>
        
        <div class="supported-formats">
            Supported formats: <?php echo strtoupper(implode(', ', $this->readerService->getConfig()->getAllowedExtensionTypes())); ?>
        </div>

        <form method="POST" enctype="multipart/form-data">
            <input type="file" name="uploaded_file" accept="<?php 
                $mimeTypes = implode(',', array_map(function($type) { 
                    return '.' . $type; 
                }, $this->readerService->getConfig()->getAllowedExtensionTypes()));
                echo $mimeTypes . ',' . implode(',', $this->readerService->getConfig()->getAllowedMimeTypes());
            ?>" required>
            <button type="submit">Upload</button>
        </form>

        <?php if (isset($error) && $error): ?>
            <div class="error">
                <?php echo htmlspecialchars($error); ?>
            </div>
        <?php endif; ?>

        <?php if (!empty($parsingErrors)): ?>
            <div class="parsing-errors">
                <h3>Parsing Issues:</h3>
                <ul>
                <?php foreach ($parsingErrors as $error): ?>
                    <li>
                        <?php if ($error['type'] !== 'json'): ?>
                            Line <?php echo $error['line']; ?>: 
                        <?php endif; ?>
                        <?php echo htmlspecialchars($error['message']); ?>
                    </li>
                <?php endforeach; ?>
                </ul>
            </div>
        <?php endif; ?>

        <?php if (isset($data) && $data): ?>
            <div class="data-container">
                <h2>File Contents:</h2>
                <?php if ($result['tableData']): ?>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <?php foreach ($result['tableData']['headers'] as $header): ?>
                                        <th><?php echo htmlspecialchars($header); ?></th>
                                    <?php endforeach; ?>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($result['tableData']['rows'] as $row): ?>
                                    <tr>
                                        <?php foreach ($result['tableData']['headers'] as $header): ?>
                                            <td><?php echo htmlspecialchars($row[$header] ?? ''); ?></td>
                                        <?php endforeach; ?>
                                    </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                <?php else: ?>
                    <pre><?php echo htmlspecialchars(print_r($data, true)); ?></pre>
                <?php endif; ?>
            </div>
        <?php endif; ?>
    </div>
</body>
</html>
